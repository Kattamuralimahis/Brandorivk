<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brandorivk - Admin Panel</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<style>
:root{ --primary:#6956ff; --line:#e9edfb; --text:#1a1a2e; --success:#27ae60; --danger:#e74c3c; --warning:#f39c12; }
*{ box-sizing:border-box; margin:0; padding:0; }
body{ font-family:Arial, sans-serif; background:#f5f7fb; color:var(--text); padding:20px; }
.container{ max-width:1200px; margin:0 auto; }
header{ background:#fff; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,.1); display:flex; justify-content:space-between; align-items:center; }
h1{ color:var(--text); }
.stats{ display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-bottom:30px; }
.stat-card{ background:linear-gradient(135deg, var(--primary), #403ab4); color:#fff; padding:20px; border-radius:8px; text-align:center; }
.stat-card h3{ font-size:2rem; margin-bottom:5px; }
.stat-card p{ opacity:0.9; }
.section{ background:#fff; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,.1); }
.section h2{ margin-bottom:20px; color:var(--text); border-bottom:2px solid var(--line); padding-bottom:10px; }
table{ width:100%; border-collapse:collapse; }
th, td{ padding:12px; text-align:left; border-bottom:1px solid var(--line); }
th{ background:#f8f9fa; font-weight:600; }
tr:hover{ background:#f8f9fa; }
.btn{ padding:6px 12px; border:none; border-radius:4px; cursor:pointer; font-size:0.85rem; margin:2px; }
.btn-approve{ background:var(--success); color:#fff; }
.btn-reject{ background:var(--danger); color:#fff; }
.btn-view{ background:var(--info); color:#fff; }
.btn-logout{ background:var(--danger); color:#fff; padding:10px 20px; }
.status{ padding:6px 12px; border-radius:20px; font-size:0.85rem; font-weight:600; display:inline-block; }
.status-pending{ background:#ffeaa7; color:#d63031; }
.status-approved{ background:#55efc4; color:#00b894; }
.status-rejected{ background:#fab1a0; color:#d63031; }
.status-confirmed{ background:#fff3cd; color:#856404; }
.status-delivered{ background:#c3e6cb; color:#155724; }
.login-box{ max-width:400px; margin:100px auto; background:#fff; padding:40px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.1); }
.login-box h2{ text-align:center; margin-bottom:20px; }
.form-group{ margin-bottom:15px; }
.form-group label{ display:block; margin-bottom:5px; font-weight:600; }
.form-group input{ width:100%; padding:12px; border:2px solid var(--line); border-radius:8px; font-size:1rem; }
.form-group input:focus{ outline:none; border-color:var(--primary); }
.submit-btn{ width:100%; padding:15px; background:var(--primary); color:#fff; border:none; border-radius:8px; font-size:1.1rem; font-weight:700; cursor:pointer; }
.submit-btn:hover{ opacity:0.9; }
.toast{ position:fixed; bottom:20px; right:20px; background:var(--success); color:white; padding:12px 24px; border-radius:8px; z-index:1000; display:none; }
.toast.error{ background:var(--danger); }
.hidden{ display:none; }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="login-box">
  <h2>üîê Admin Login</h2>
  <form onsubmit="adminLogin(event)">
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="adminEmail" required placeholder="brandorivk@gmail.com">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="adminPassword" required placeholder="Enter password">
    </div>
    <button type="submit" class="submit-btn">Login</button>
  </form>
</div>

<!-- Admin Dashboard -->
<div id="adminDashboard" class="container hidden">
  <header>
    <h1>üë®‚Äçüíº Admin Panel - Payment Verification</h1>
    <button onclick="adminLogout()" class="btn btn-logout">üö™ Logout</button>
  </header>

  <div class="stats">
    <div class="stat-card"><h3 id="statTotal">0</h3><p>Total Orders</p></div>
    <div class="stat-card" style="background:linear-gradient(135deg, #f39c12, #e67e22);"><h3 id="statPending">0</h3><p>Pending Payment</p></div>
    <div class="stat-card" style="background:linear-gradient(135deg, #3498db, #2980b9);"><h3 id="statApproved">0</h3><p>Payment Approved</p></div>
    <div class="stat-card" style="background:linear-gradient(135deg, #27ae60, #229954);"><h3 id="statDelivered">0</h3><p>Delivered</p></div>
  </div>

  <div class="section">
    <h2>‚è≥ Pending Payment Verifications</h2>
    <table>
      <thead>
        <tr><th>Order ID</th><th>Customer</th><th>Phone</th><th>Amount</th><th>UTR Number</th><th>Submitted</th><th>Actions</th></tr>
      </thead>
      <tbody id="pendingTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>üìã All Orders</h2>
    <table>
      <thead>
        <tr><th>Order ID</th><th>Customer</th><th>Amount</th><th>Payment</th><th>Order Status</th><th>Actions</th></tr>
      </thead>
      <tbody id="allOrdersTable"></tbody>
    </table>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================
// FIREBASE CONFIG
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyBnYRf-mptGr3oA6ZqmJsjM9m6RCUz4mbM",
  authDomain: "brandorivk-9a3c2.firebaseapp.com",
  projectId: "brandorivk-9a3c2",
  storageBucket: "brandorivk-9a3c2.firebasestorage.app",
  messagingSenderId: "351821603694",
  appId: "1:351821603694:web:8b1181b5eaa2253b3a577f",
  measurementId: "G-WM887NHXE9"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "brandorivk@gmail.com"; // ‚úÖ YOUR ADMIN EMAIL
const PAYMENT_STATUS = { PENDING: 'pending', APPROVED: 'approved', REJECTED: 'rejected' };
const ORDER_STATUS = { CONFIRMED: 'confirmed', DISPATCHED: 'dispatched', IN_TRANSIT: 'transit', DELIVERED: 'delivered' };

// ============================================
// AUTH
// ============================================
auth.onAuthStateChanged((user) => {
  if (user && user.email === ADMIN_EMAIL) {
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("adminDashboard").classList.remove("hidden");
    loadDashboard();
  } else {
    document.getElementById("loginScreen").classList.remove("hidden");
    document.getElementById("adminDashboard").classList.add("hidden");
  }
});

function adminLogin(e){
  e.preventDefault();
  const email = document.getElementById("adminEmail").value;
  const password = document.getElementById("adminPassword").value;
  
  if(email !== ADMIN_EMAIL){ showToast("Not an admin account!", "error"); return; }
  
  auth.signInWithEmailAndPassword(email, password)
    .then(() => { showToast("Login successful!"); })
    .catch((error) => { showToast("Login failed: " + error.message, "error"); });
}

function adminLogout(){
  auth.signOut().then(() => { showToast("Logged out"); });
}

// ============================================
// DASHBOARD
// ============================================
function loadDashboard(){
  db.collection('orders').orderBy('orderDate', 'desc').get().then((snapshot) => {
    const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    
    // Stats
    document.getElementById("statTotal").textContent = orders.length;
    document.getElementById("statPending").textContent = orders.filter(o => o.paymentStatus === PAYMENT_STATUS.PENDING && !o.utr).length;
    document.getElementById("statApproved").textContent = orders.filter(o => o.paymentStatus === PAYMENT_STATUS.APPROVED).length;
    document.getElementById("statDelivered").textContent = orders.filter(o => o.status === ORDER_STATUS.DELIVERED).length;
    
    // Pending payments
    const pending = orders.filter(o => o.paymentStatus === PAYMENT_STATUS.PENDING && o.utr);
    document.getElementById("pendingTable").innerHTML = pending.length === 0 ?
      '<tr><td colspan="7" style="text-align:center;padding:2rem;color:#666;">No pending payments</td></tr>' :
      pending.map(order => `
        <tr>
          <td><strong>${order.orderId}</strong></td>
          <td>${order.customer.name}</td>
          <td>${order.customer.phone}</td>
          <td>‚Çπ${order.total.toLocaleString('en-IN')}</td>
          <td><strong>${order.utr}</strong></td>
          <td>${order.paymentSubmittedAt ? order.paymentSubmittedAt.toDate().toLocaleString() : '-'}</td>
          <td>
            <button onclick="approvePayment('${order.id}', '${order.orderId}')" class="btn btn-approve">‚úÖ Approve</button>
            <button onclick="rejectPayment('${order.id}', '${order.orderId}')" class="btn btn-reject">‚ùå Reject</button>
          </td>
        </tr>
      `).join('');
    
    // All orders
    document.getElementById("allOrdersTable").innerHTML = orders.length === 0 ?
      '<tr><td colspan="6" style="text-align:center;padding:2rem;color:#666;">No orders yet</td></tr>' :
      orders.map(order => {
        const paymentLabels = { [PAYMENT_STATUS.PENDING]: "‚è≥ Pending", [PAYMENT_STATUS.APPROVED]: "‚úÖ Approved", [PAYMENT_STATUS.REJECTED]: "‚ùå Rejected" };
        const paymentClasses = { [PAYMENT_STATUS.PENDING]: "status-pending", [PAYMENT_STATUS.APPROVED]: "status-approved", [PAYMENT_STATUS.REJECTED]: "status-rejected" };
        const orderLabels = { confirmed: "Confirmed", dispatched: "Dispatched", transit: "In Transit", delivered: "Delivered" };
        const orderClasses = { confirmed: "status-confirmed", dispatched: "status-confirmed", transit: "status-confirmed", delivered: "status-delivered" };
        return `
          <tr>
            <td><strong>${order.orderId}</strong></td>
            <td>${order.customer.name}</td>
            <td>‚Çπ${order.total.toLocaleString('en-IN')}</td>
            <td><span class="status ${paymentClasses[order.paymentStatus]}">${paymentLabels[order.paymentStatus]}</span></td>
            <td><span class="status ${orderClasses[order.status]}">${orderLabels[order.status]}</span></td>
            <td><button onclick="viewOrder('${order.id}')" class="btn btn-view">View</button></td>
          </tr>
        `;
      }).join('');
  }).catch(err => { console.error("Error loading orders:", err); });
}

function approvePayment(firestoreId, orderId){
  if(!confirm("Approve payment for order " + orderId + "?")) return;
  db.collection('orders').doc(firestoreId).update({
    paymentStatus: PAYMENT_STATUS.APPROVED,
    paymentApprovedAt: firebase.firestore.FieldValue.serverTimestamp(),
    status: ORDER_STATUS.CONFIRMED
  }).then(() => {
    showToast("Payment approved! Order confirmed.", "success");
    loadDashboard();
  }).catch(err => { showToast("Error approving payment", "error"); console.error(err); });
}

function rejectPayment(firestoreId, orderId){
  if(!confirm("Reject payment for order " + orderId + "?")) return;
  db.collection('orders').doc(firestoreId).update({
    paymentStatus: PAYMENT_STATUS.REJECTED
  }).then(() => {
    showToast("Payment rejected", "error");
    loadDashboard();
  }).catch(err => { showToast("Error rejecting payment", "error"); console.error(err); });
}

function viewOrder(firestoreId){
  db.collection('orders').doc(firestoreId).get().then((doc) => {
    if(doc.exists){
      const order = doc.data();
      alert(`Order Details:\n\nOrder ID: ${order.orderId}\nCustomer: ${order.customer.name}\nEmail: ${order.customer.email}\nPhone: ${order.customer.phone}\nAmount: ‚Çπ${order.total}\nUTR: ${order.utr || 'Not submitted'}\nPayment: ${order.paymentStatus}\nStatus: ${order.status}`);
    }
  });
}

function showToast(msg, type = "success"){
  const t = document.getElementById("toast");
  t.textContent = msg; t.className = "toast" + (type === "error" ? " error" : "");
  t.style.display = "block"; setTimeout(() => t.style.display = "none", 3000);
}
</script>

</body>
</html>